Bootstrap: docker
From: pytorch/pytorch:2.6.0-cuda12.6-cudnn9-runtime

%files
    src/pipeline.py /app/pipeline.py
    src/predict.py /app/predict.py
    src/requirements.txt /app/requirements.txt

%post
    # Install dependencies
    python3 -m pip install --no-cache-dir -U pip setuptools wheel
    python3 -m pip install --no-cache-dir -r /app/requirements.txt
    
    # Create directories securely
    mkdir -p /input /output /results
    
    # Install system dependencies
    apt-get update && apt-get install -y --no-install-recommends \
        python3-minimal \
        git \
        wget \
        && rm -rf /var/lib/apt/lists/*
        
    # Make scripts executable
    chmod +x /app/*.py

%environment
    export PYTHONPATH=/app:${PYTHONPATH:-}
    export LC_ALL=C.UTF-8

%runscript
    python3 /app/predict.py --input /input --output /output "$@"